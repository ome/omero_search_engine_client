{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% block title %}Client for Omero search engine - Index{% endblock %}
{% block app_content %}+
<section class="container py-4" style="float : left;">
    <div class="row">
        <div class="col-md-12">
            <div style="float: right">
              <label for="commonattr">Common attribute mode: </label>
                          <input type="checkbox" id ="commonattr" checked data-toggle="toggle" data-onstyle="success" data-offstyle="danger" data-size="mini">
            </div>
            <br>
            <ul id="tabs" class="nav nav-tabs">
                <li class="nav-item"><a href="#home1" data-toggle="tab" data-target="#home1"  class="nav-link small text-uppercase active"> Attribute Browser </a></li>
                <li class="nav-item" id="querybuilder_nav"><a href="#querybuilder" data-toggle="tab"  data-target="#querybuilder" class="nav-link small text-uppercase ">Query Builder</a></li>
                <li class="nav-item"><a href="#templates"  data-toggle="tab" data-target="#templates" class="nav-link small text-uppercase">Templates</a></li>
                     </ul>
                    <br>
                    <div id="tabsContent" class="tab-content">
                        <div id="home1" class="tab-pane fade active show">
                             <form class="form-inline">
                       <input id ="value_field" class="form-control mr-sm-3" type="search" placeholder="search for any value" aria-label="Search">
                       <button  id="value_field_search_only" class="btn btn-success " type="submit">Search</button>
                  </form>

                    <div class="modal-body row">

                      <div class="col-md-3 "style="border-right: 1px solid black;  " >

                          <h4>Attributes browser</h4>
                          <div id="jstree_resource_div"></div>
                      </div>
          <div id="attribute_search_results" class="col-md-9">

              <div class="m-4" id="help_message">



        <a href="#" class="list-group-item list-group-item-action list-group-item-primary">
            Double click on the desired attribute node in the tree on the left-hand side to browse the available values. The results will be in a table that contains rows (buckets) which each contain the attribute, value and the number of items. To explore the values inside the bucket, double click the relvant row.
        </a>
        <a href="#" class="list-group-item list-group-item-success">
            It is possible to use the value search field to search for a value whose attribute is not known.

        </a>
                   <a href="#" class="list-group-item list-group-item-danger">
            The search results are limited to 9999, paging will be added later to allow pulling all the results .

        </a>
                  <a href="#" class="list-group-item list-group-item-action list-group-item-primary">
                  "Query Builder" tab contains a search form that can be used to build a complex query. Queries which are built using "Query Builder" return all the results by applying paging.
                  </a>



</div>
               <div>
                         <label id="total_number_in_buckets"></label>
                   <br>

                       <div id="grid_key_values"  class="ag-theme-alpine"></div>
                   <br>
                </div>
              <button id="exportsearchResults" class="btn btn-primary"  style="display: none" type="button">Export Results (CSV)</button>
          </div>
</div>
                    </div>
                <div id="querybuilder" class="tab-pane fade ">
                    <div class="row pb-2">


<input type="file" name="load_file" id="load_file" style="display: none" />
<div class="page-header">
   <!--h4>Query Builder Form<sup>*</sup></h4-->
</div>
<br>
<div id="query">
   <div  id="queryParent">
      <div id="resources" style="display: none"  >
         <div style="float: right" class="col-md-6">
            <button type="button" class="btn btn-info" data-toggle="tooltip" data-placement="top"
               title="load the query from user storage" onclick="load_query()">
               Load
            </button>
            <br/>
            <textarea id="queryJson">JSON</textarea>
         </div>

         <div id="conanew" class="col-md-6">
            <div id="template">
            <br>
            <form id="search_form">
               <div class="and_clause">
                  <div class="form-row">
                     <div class="form-group col-md-1 or">OR</div>
                     <div class="form-group col-md-4">
                        <label for="keyFields">Attribute</label>
                        <select id="keyFields" class="form-control keyFields">
                        </select>
                     </div>
                     <div class="form-group col-md-2">
                        <label for="condtion">Operator</label>
                        <select id="condtion" class="form-control condition">
                        </select>
                     </div>
                     <div class="form-group col-md-4" style="position: relative">
                        <label for="valueFields">Value</label>
                        <input type="text" class="form-control valueFields" id="valueFields" onfocus="setAutoCompleteValues()">
                     </div>
                     <div class="form-group col-md-1 or"><button class="btn btn-sm btn-outline-danger remove">X</button></div>
                  </div>
                  <a class="addOR" href="#" title="Add OR condition to the group">
                     add 'OR'...
                  </a>
               </div>
            </form>
            <button id="addAND" type="button" class="btn btn-success" data-toggle="tooltip" data-placement="top" title="Add group">
               add AND
            </button>
         </div>

         </div>
         <br>
                  <div id="conaneworpar" >
         <div id="conanewor" class="col-md-5">
            <div id="ortemplate" >
      </div>
         </div>
                  </div>
      </div>
   </div>
   <br>
   <div id ="conditions">
      <div class="col-md-5">
         <div class="float-right">
            <input class="form-check-input" type="checkbox" value="" id="case_sensitive" >
            <label class="form-check-label" for="case_sensitive">
            Case sensitive
            </label>
         </div>



      </div>
      <br>
   </div>
   <div id ="query_buttons">
      <button type="button" id="submit_" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Submit the query to the server" onclick="submitQuery()">
      Submit the Query
      </button>

      <button type="button" id="new_query" class="btn btn-danger" data-toggle="tooltip" data-placement="top" title="Discard all the condition anstart new query" onclick="reset_query()">
      Reset the Form
      </button>
   </div>
   <br>
   <br>
   <div id="results" class="col-md-4" style="display: none"  >
      <h4>Results</h4>
      <br>
      <label id="no_images"></label>
      <label id="query_id"></label>
      <br>
   </div>
   <th><button id="reset_results_table_filter"  onclick="resetResultsTabelFilters()" type="button"  style="display: none" >Remove Filter/s</button></th>
    <th><button id="display_dide_columns"  onclick="#" type="button"  style="display: none" >Display/Hide Columns</button></th>


   <div id="myGrid_2"  class="ag-theme-alpine"></div>
   <br>
   <div id="load_results_buttons", style="display: none", class="col-md-7" >
   <table id="loads_results_table" class="table table-striped">
      <thead>
         <tr>
            <th><button  class="btn btn-primary" id="loadMoreResults"  onclick="loadMoreResultsFunction()" type="button">Load More Results</button></th>
         </tr>
         <tr>
            <th><button id="loadRemainingResults"  onclick="loadRemainingResultsFunction()" type="button" style="display: none">Load All the Results</button></th>
         </tr>
      </thead>
   </table>
 </div>
<br>
<button id="exportResults" class="btn btn-primary"  style="display: none"  onclick="exportToCSV()" type="button">Export Results (CSV)</button>
<br>
</div>
<script src={{url_for('static',filename='/js/resource_handeler_new_gui.js')}}></script>
<script>
   var resources_data = {{ resources_data|tojson }};
   var operator_choices= {{ operator_choices|tojson }};
   var query_id= {{ task_id|tojson }};
   var mode= {{ mode|tojson }}
   var submitqueryurl = "{{ client_url }}{{ url_for('main.submit_query') }}";
   var queryresultsurl = "{{ client_url }}{{ url_for('main.queryresults') }}";
   var  getresourcesvalesforkey = "{{ client_url }}{{ url_for('main.get_resourcse_key') }}";
   var  searchresourcesvales = "{{ client_url }}{{ url_for('main.get_resourcse_using_values_only') }}";
   var  searchresourcesvalesforkey = "{{ client_url }}{{ url_for('main.get_values_using_values_using_key') }}";
   var  getresourceskeysusingmode ="{{ client_url }}{{  url_for('main.get_resourcses_keys') }}";

   $(document).ajaxStart(function ()
   {
   $('body').addClass('wait');

   }).ajaxComplete(function () {

   $('body').removeClass('wait');

   });


     $("form").submit(function (e) {
         e.preventDefault();

     });
</script>
                    </div>
                </div>
                <div id="templates" class="tab-pane fade">
                    <h3>
Under construction, please visit later!
                        </h3>
            </div>
        </div>
    </div>
</section>
{% endblock %}